{% extends "base.html" %}
{% block title %}Posts - SJ Home Agent{% endblock %}

{% block content %}
<h1>Posts</h1>

<div style="margin-bottom: 1.5rem; display: flex; gap: 0.5rem; align-items: center;">
    <a href="/posts" style="padding: 0.4rem 0.8rem; border: 1px solid #ccc; border-radius: 4px; text-decoration: none; color: {% if not status_filter %}#fff{% else %}#333{% endif %}; background: {% if not status_filter %}#333{% else %}#fff{% endif %};">All</a>
    <a href="/posts?status=draft" style="padding: 0.4rem 0.8rem; border: 1px solid #ccc; border-radius: 4px; text-decoration: none; color: {% if status_filter == 'draft' %}#fff{% else %}#333{% endif %}; background: {% if status_filter == 'draft' %}#333{% else %}#fff{% endif %};">Drafts</a>
    <a href="/posts?status=published" style="padding: 0.4rem 0.8rem; border: 1px solid #ccc; border-radius: 4px; text-decoration: none; color: {% if status_filter == 'published' %}#fff{% else %}#333{% endif %}; background: {% if status_filter == 'published' %}#333{% else %}#fff{% endif %};">Published</a>
    <div style="flex: 1;"></div>
    <a href="/write" style="padding: 0.4rem 1rem; background: #333; color: #fff; border-radius: 4px; text-decoration: none;">+ New Post</a>
</div>

{% if posts %}
<div style="display: flex; flex-direction: column; gap: 1rem;">
    {% for post in posts %}
    <div style="border: 1px solid #eee; border-radius: 6px; padding: 1rem;">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <h3 style="margin: 0 0 0.3rem 0;">{{ post.title }}</h3>
                <div style="display: flex; gap: 0.5rem; align-items: center; font-size: 0.85rem; color: #888;">
                    <span style="padding: 0.15rem 0.5rem; border-radius: 3px; font-size: 0.8rem;
                                 background: {% if post.status == 'published' %}#e8f5e9{% else %}#fff3e0{% endif %};
                                 color: {% if post.status == 'published' %}#2e7d32{% else %}#ef6c00{% endif %};">
                        {{ post.status }}
                    </span>
                    <span>{{ post.category }}</span>
                    <span>{{ post.updated_at[:10] }}</span>
                    {% if post.tags %}
                    <span>{{ post.tags }}</span>
                    {% endif %}
                </div>
            </div>
            <div style="display: flex; gap: 0.3rem; flex-shrink: 0;">
                <a href="/posts/{{ post.id }}/edit" style="padding: 0.3rem 0.6rem; border: 1px solid #ccc; border-radius: 4px; text-decoration: none; color: #333; font-size: 0.85rem;">Edit</a>
                {% if post.status == 'draft' %}
                <form method="post" action="/posts/{{ post.id }}/publish" style="display:inline;">
                    <button type="submit" style="padding: 0.3rem 0.6rem; background: #2e7d32; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">Publish</button>
                </form>
                {% endif %}
                <form method="post" action="/posts/{{ post.id }}/delete" style="display:inline;" onsubmit="return confirm('Delete this post?');">
                    <button type="submit" style="padding: 0.3rem 0.6rem; background: #c62828; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">Delete</button>
                </form>
            </div>
        </div>
        {% if post.content %}
        <p style="color: #666; margin: 0.5rem 0 0 0; font-size: 0.9rem;">{{ post.content[:150] }}{% if post.content|length > 150 %}...{% endif %}</p>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% else %}
<p style="color: #888; text-align: center; padding: 3rem;">No posts yet. <a href="/write">Write your first post</a>.</p>
{% endif %}
{% endblock %}
